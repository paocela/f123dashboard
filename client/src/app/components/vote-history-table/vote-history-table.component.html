<div class="table-responsive-custom">
  <table
    [hover]="true"
    [striped]="true"
    align="middle"
    cTable
    class="mb-0 border storico-table"
  >
    <thead>
      <tr>
        <th class="bg-body-tertiary text-center col-voto">
          <span class="d-none d-md-inline">Voto</span>
          <span class="d-md-none">#</span>
        </th>
        <th class="bg-body-tertiary text-center col-avatar">
          <svg cIcon name="cilPeople"></svg>
        </th>
        <th class="bg-body-tertiary col-username">
          <span class="d-none d-sm-inline">Username</span>
          <span class="d-sm-none">Nome</span>
        </th>
        <th class="bg-body-tertiary text-center col-posizione">
          <span class="d-none d-md-inline">Posizione di arrivo</span>
          <span class="d-md-none">Pos.</span>
        </th>
        <th class="bg-body-tertiary text-center col-punti">
          <span class="d-none d-sm-inline">Punti fatti</span>
          <span class="d-sm-none">Pt.</span>
        </th>
        <th class="bg-body-tertiary text-center col-risultato">
          <span class="d-none d-sm-inline">Risultato</span>
          <span class="d-sm-none">âœ“</span>
        </th>
      </tr>
    </thead>

    <tbody>
      @for (voto of getVoteArray(); track i; let i = $index) {
        <tr>
          <td class="col-voto">
            <div class="text-center fw-semibold voto-label">
              @if (i + 1 <= 8) {
                <div>{{ i + 1 }}</div>
              } @else if (i + 1 == 9) {
                <div>GV</div>
              } @else if (i + 1 == 10) {
                <div>DNF</div>
              } @else {
                <div>TEAM</div>
              }
            </div>
          </td>
          <td class="text-center col-avatar">
            @if (i + 1 <= 10) {
              <c-avatar
                class="storico-avatar"
                [size]="'md'"
                src="./assets/images/avatars/{{
                  getPilota(voto) ? getPilota(voto).driver_username : 'invalid'
                }}.png"
              />
            } @else {
              <c-avatar
                class="storico-avatar"
                [size]="'md'"
                src="./assets/images/constructors/{{
                  getConstructor(voto)
                }}.png"
              />
            }
          </td>
          <td class="col-username">
            @if (i + 1 <= 10) {
              <div class="username-text">{{ getPilota(voto) ? getPilota(voto).driver_username : '-' }}</div>
            } @else {
              <div class="username-text">{{ getConstructor(voto) || '-' }}</div>
            }
          </td>
          <td class="col-posizione">
            @if (i + 1 <= 8) {
              <div class="fw-semibold text-center posizione-value">
                {{ getPosizioneArrivo(voto) }}
              </div>
            } @else if (i + 1 == 9) {
              <div class="fw-semibold text-center posizione-value">
                @if (+getFastLap() === +voto) {
                  SI
                } @else {
                  NO
                }
              </div>
            } @else if (i + 1 == 10) {
              <div class="fw-semibold text-center posizione-value">
                @if (fantaService.isDnfCorrect(getDnf(), voto)) {
                  SI
                } @else {
                  NO
                }
              </div>
            } @else {
              <div class="fw-semibold text-center posizione-value">
                @if (fantaService.getWinningConstructorForTrack(trackId) && +fantaService.getWinningConstructorForTrack(trackId)! === +voto) {
                  SI
                } @else {
                  NO
                }
              </div>
            }
          </td>
          <td class="col-punti">
            <div class="fw-semibold text-center punti-value">
              @if (i + 1 <= 8) {
                {{ getPunti(voto) }}
              } @else if (i + 1 == 9) {
                {{ getPuntiFastLap() }}
              } @else if (i + 1 == 10) {
                {{ getPuntiDnf() }}
              } @else {
                {{ getPuntiConstructor() }}
              }
            </div>
          </td>
          <td class="col-risultato">
            <div class="text-center risultato-icon">
              @if (i + 1 <= 8) {
                <svg
                  [cIcon]="isCorrect(voto).icon"
                  size="lg"
                  [ngStyle]="{ color: isCorrect(voto).color }"
                ></svg>
              } @else if (i + 1 == 9) {
                <svg
                  [cIcon]="isCorrectFastLap().icon"
                  size="lg"
                  [ngStyle]="{ color: isCorrectFastLap().color }"
                ></svg>
              } @else if (i + 1 == 10) {
                <svg
                  [cIcon]="isCorrectDnf().icon"
                  size="lg"
                  [ngStyle]="{ color: isCorrectDnf().color }"
                ></svg>
              } @else {
                <svg
                  [cIcon]="isCorrectConstructor().icon"
                  size="lg"
                  [ngStyle]="{ color: isCorrectConstructor().color }"
                ></svg>
              }
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>

@if (showTotalPoints) {
  <div class="m-3">
    <h4 class="text-center text-success">
      Totale Punti: {{ getTotalPoints() }}
    </h4>
  </div>
}
