<c-container fluid class="admin-change-password-container">
  <c-row class="justify-content-center">
    <c-col xs="12" md="8" lg="6">
      <c-card class="shadow-sm">
        <c-card-header class="bg-primary text-white">
          <h4 class="mb-0">
            <svg [cIcon]="cilLockLocked" class="me-2" size="lg"></svg>
            Modifica Password Utente
          </h4>
        </c-card-header>
        <c-card-body>
          <!-- Success Alert -->
          @if (showSuccess) {
            <c-alert 
              color="success" 
              [dismissible]="true"
              (visibleChange)="showSuccess = $event">
              <svg [cIcon]="cilCheckCircle" class="me-2"></svg>
              {{ successMessage }}
              <div class="mt-3 p-3 bg-light border rounded">
                <strong>Password Temporanea:</strong>
                <div class="d-flex align-items-center mt-2">
                  <code class="fs-5 text-primary bg-white p-2 rounded border flex-grow-1">{{ generatedPassword }}</code>
                  <button 
                    type="button"
                    class="btn btn-sm btn-outline-primary ms-2"
                    (click)="copyToClipboard(generatedPassword)"
                    title="Copia negli appunti">
                    üìã Copia
                  </button>
                </div>
                <small class="text-muted d-block mt-2">
                  ‚ö†Ô∏è Assicurati di comunicare questa password all'utente in modo sicuro. Sar√† inviata anche via email.
                </small>
              </div>
            </c-alert>
          }

          <!-- Error Alert -->
          @if (showError) {
            <c-alert 
              color="danger" 
              [dismissible]="true"
              (visibleChange)="showError = $event">
              <svg [cIcon]="cilXCircle" class="me-2"></svg>
              {{ errorMessage }}
            </c-alert>
          }

          <form 
            cForm 
            [formGroup]="changePasswordForm" 
            (ngSubmit)="onSubmit()"
            class="needs-validation">
            
            <!-- Username Field -->
            <div class="mb-4">
              <label cFormLabel for="username" class="form-label">
                <svg [cIcon]="cilUser" class="me-2"></svg>
                Nome Utente
              </label>
              <input
                cFormControl
                type="text"
                id="username"
                formControlName="username"
                placeholder="Inserisci il nome utente"
                [class.is-invalid]="isFieldInvalid('username')"
                autocomplete="username"
              />
              @if (isFieldInvalid('username')) {
                <div class="invalid-feedback">
                  {{ getErrorMessage('username') }}
                </div>
              }
              <small class="form-text text-muted">
                Inserisci il nome utente dell'account di cui vuoi modificare la password. Verr√† generata automaticamente una password temporanea.
              </small>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2">
              <button
                cButton
                color="primary"
                type="submit"
                [disabled]="isLoading || changePasswordForm.invalid"
                class="btn-lg">
                @if (isLoading) {
                  <c-spinner
                    aria-hidden="true"
                    size="sm"
                    class="me-2"
                  ></c-spinner>
                }
                @if (!isLoading) {
                  <span>
                    <svg [cIcon]="cilCheckCircle" class="me-2"></svg>
                    Modifica Password
                  </span>
                }
                @if (isLoading) {
                  <span>Modifica in corso...</span>
                }
              </button>
            </div>
          </form>
        </c-card-body>
      </c-card>

      <!-- Security Notice -->
      <div class="alert alert-info mt-3" role="alert">
        <h6 class="alert-heading">
          <svg [cIcon]="cilLockLocked" class="me-2"></svg>
          Nota sulla Sicurezza
        </h6>
        <p class="mb-0 small">
          Questa funzione √® disponibile solo per gli amministratori. Verr√† generata automaticamente una password temporanea di 8 caratteri che sar√† inviata via email all'utente.
        </p>
      </div>
    </c-col>
  </c-row>
</c-container>
